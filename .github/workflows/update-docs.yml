name: "Update API Docs and Create PR"

on:
  push:
    branches:
      - main  # Adjust this branch based on your main branch name

jobs:
  update-docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Generate or Update Documents
        run: |
      - name: Create directories
        run: "mkdir -p packages/docs/apis"

      - name: Create Lorem Ipsum JSON file
        run: |
          echo '{"content": "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat."}' > packages/docs/apis/lorem_ipsum.json
      - name: Print GitHub Token
        run: |
         echo "GitHub Token: ${{ secrets.GH_TOKEN }}"
      - name: Commit Changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add .
          git diff-index --quiet HEAD || git commit -m "Add or update API docs [skip ci]"

      - name: Remove Existing Remote
        run: |
            echo "Starting this part 7"
            REMOTE_NAME="other_repo"
        
            if git remote get-url $REMOTE_NAME >/dev/null 2>&1; then
              echo "Removing existing remote"
              git remote remove $REMOTE_NAME
            fi

      - name: Push Changes
        run: |
         echo "Starting this part 1"
          git remote add other_repo https://${{ secrets.GH_TOKEN }}@github.com/jamesnsinclair/pern-todo
          echo "Starting this part 2"
          git push other_repo
      - name: Create Pull Request
        run: |
          echo "Starting this part 3"
          ACCESS_TOKEN=${{ secrets.GH_TOKEN }}
          REPO_OWNER="JamesNSinclair@gmail.com"
          REPO_NAME="pern-todo"
          BASE_BRANCH="master"
          HEAD_BRANCH="master"
          PR_RESPONSE=$(curl -X POST \
            -H "Authorization: Bearer $ACCESS_TOKEN" \
            -H "Accept: application/vnd.github.v3+json" \
            https://api.github.com/repos/$REPO_OWNER/$REPO_NAME/pulls \
            -d '{"title":"Add or Update API docs","body":"This PR adds or updates the API documentation.\n\nPlease run the linter on the doc and fix any linting issues before merging. The lint command can be run locally by setting up the project and running npm run lint from within packages/docs.","head":"'$HEAD_BRANCH'","base":"'$BASE_BRANCH'"}')
            echo "Starting this part 3"
          PR_URL=$(echo $PR_RESPONSE | jq -r .html_url)
          echo "Pull Request created: $PR_URL"
